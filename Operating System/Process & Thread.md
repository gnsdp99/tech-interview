> # Process & Thread

#### Q. 스레드

---

스레드는 프로세스를 구성하는 실행 흐름의 단위이다.

즉 하나의 프로세스에는 하나 이상의 스레드가 있다.

각 스레드는 PC(Program Counter)를 포함한 레지스터와 스택의 고유한 자원을 가지고, 프로세스의 스택 영역을 제외한 나머지 메모리 영역을 공유한다.

<br>

#### Q. TCB (Thread Control Block)

---

프로세스와 마찬가지로 스레드 또한 스레드 정보를 저장하는 TCB라는 자료구조를 가진다.

![TCB](/images/tcb.png)

TCB는 스레드와 함께 생성되고 소멸된다.

스레드 간의 자원 공유와 동기화도 TCB로 관리한다.

<br>

#### Q. 멀티 프로세스와 멀티 스레드

---

> 멀티 프로세스 : 동일한 작업을 수행하는 단일 스레드 프로세스를 여러 개 실행하는 것
>
> 멀티 스레드 : 하나의 프로세스를 여러 스레드로 실행하는 것

![멀티 프로세스 vs. 멀티 스레드](/images/multiprocess_vs_multithread.png)

프로세스는 서로 자원을 공유하지 않지만, 같은 프로세스 내의 스레드는 프로세스의 코드, 데이터, 힙 영역을 공유한다.

멀티 프로세스의 특징

- 하나의 프로세스가 죽어도 다른 프로세스에 영향을 주지 않으므로 안정성이 높다.

- 하지만 멀티 스레드보다 많은 메모리 공간과 CPU 자원을 차지하는 단점이 있다.

- 독립된 메모리 영역을 사용하기 때문에 컨텍스트 스위칭 오버헤드가 크다.

멀티 스레드의 특징

- 프로세스 간의 통신보다 스레드 간의 통신 비용이 적다.

- 프로세스를 생성하여 자원을 할당하는 시스템 콜 호출이 적기 때문에 더 효율적이다.

- 하지만 스레드 간에 자원을 공유하기 때문에 동기화 문제가 발생할 수 있다.

<br>

#### Q. 프로세스 컨텍스트 스위칭 vs 스레드 컨텍스트 스위칭

---

기본적으로 프로세스 컨텍스트 스위칭은 다음과 같은 작업을 수행한다.

1. 현재 실행 중인 프로세스의 컨텍스트를 저장한다.

2. CPU 캐시를 비운다.

3. TLB(Table Lookaside Buffer)를 비운다.

4. MMU(Memory Management Unit)을 변경한다.

2, 3, 4번 작업은 프로세스가 서로 독립적인 메모리 공간을 할당 받기 때문에 발생한다.

그래서 스레드 컨텍스트 스위칭은 1번 작업만 수행하고, 당연히 프로세스 컨텍스트 스위칭보다 오버헤드가 적다.

하지만 스레드 컨텍스트 스위칭은 자원 동기화 문제가 발생할 수 있다.

스레드는 힙 영역을 공유하기 때문에 두 스레드가 같은 자원에 접근할 때 동기화 문제가 발생할 수 있다.

참고로 프로세스의 경우도 IPC와 같이 공유 자원을 사용하면 동기화 문제가 발생할 수 있다.

<br>

#### Q. 스레드가 많을수록 성능이 높아질까

---

동시성을 위해 멀티 스레드를 사용하는데, 그렇다면 스레드가 많을수록 무조건 성능이 높을까?

그렇지 않은 이유가 몇 가지 있다.

- 임계 영역에 대한 동기화 비용

  - 멀티 스레드는 자원을 공유하기 때문에 멀티 프로세스보다 빠르지만 공유 자원에 대한 동기화 비용이 발생한다.

- 컨텍스트 스위칭 오버헤드

  - 스레드가 많을수록 컨텍스트 스위칭이 발생하는 횟수도 많아지기 때문에 오버헤드가 커지게 된다.

- 잉여 스레드의 리소스 낭비

  - 만약 멀티 스레드 애플리케이션의 트래픽이 적다면 적은 수의 스레드만 사용하게 된다.

  - 그러면 남은 스레드들이 불필요하게 CPU, 메모리, 네트워크 등의 자원을 차지하게 되므로 성능 저하나 오류의 원인이 될 수 있다.

  - 이때는 스레드 풀을 도입해 사용할 스레드의 개수를 관리함으로써 해결할 수 있다.

- CPU 바운드 애플리케이션에서의 불필요함

  - 멀티 스레드는 여러 작업을 잘게 쪼개서 동시에 실행해야 의미가 있다.

  - 하지만 CPU 바운드(영상 처리, 데이터 마이닝) 애플리케이션은 CPU를 오래 사용해야 하기 때문에, 오히려 컨텍스트 스위칭이 성능 저하만 발생시킬 수 있다.

  - 그래서 멀티 스레드는 I/O 바운드(파일 입출력, 네트워크 통신, 데이터베이스 통신) 애플리케이션에서 이점이 있다.

  - CPU 보다 시간이 오래 걸리는 I/O 작업이 끝날 때까지 다른 작업을 처리할 수 있기 때문이다.

<br>

> 참조
>
> - 혼자 공부하는 컴퓨터 구조+운영체제 (강민철)
> - [멀티 프로세스(Multi Process)와 멀티 스레드(Multi Thread)](https://wooody92.github.io/os/%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C/)
> - [완전히 정복하는 프로세스 vs 스레드 개념](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4?pidx=20)
> - [스레드를 많이 쓸수록 항상 성능이 좋아질까?](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-Is-more-threads-always-better#%EC%8A%A4%EB%A0%88%EB%93%9C%EB%A5%BC_%EB%A7%8E%EC%9D%B4_%EC%93%B0%EB%A9%B4_%EC%93%B8%EC%88%98%EB%A1%9D_%EC%84%B1%EB%8A%A5%EC%9D%B4_%EB%86%92%EC%95%84%EC%A7%80%EB%8A%94%EA%B0%80)
> - [쉬운코드 - 운영체제](https://www.youtube.com/playlist?list=PLcXyemr8ZeoQOtSUjwaer0VMJSMfa-9G-)
